const b=g=>new URL(`../pyodide/${g}`,import.meta.url).toString(),a={chess:[b("chess-1.10.0-py3-none-any.whl")]},p=g=>{const I=[];let e;const c=/^\s*import\s+(\w+)(?:\s+as\s+\w+)?(?:\s*,\s*(\w+)(?:\s+as\s+\w+)?)*|^\s*from\s+(\w+)(?:\.\w+)*\s+import/gm,n=new Set;for(;(e=c.exec(g))!==null;){if(e[1]&&(n.add(e[1]),e[2])){const o=e[2].split(",").map(i=>i.trim());for(const i of o)i&&n.add(i)}e[3]&&n.add(e[3])}for(const o of n)if(a[o]){const i=a[o];for(const t of i)I.includes(t)||I.push(t)}return I};var G="data:application/octet-stream;base64,aW1wb3J0IG1hdHBsb3RsaWIKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgaW8KaW1wb3J0IGJhc2U2NAoKbWF0cGxvdGxpYi51c2UoJ0FHRycpCgojIEFkZCBhIHBsdCBfcmVwcl9wbmdfIGZ1bmN0aW9uIC0gdGhpcyB3aWxsIGVtaXQgYSBwbmcgaWYgcGx0IGlzIHJldHVybmVkIGZyb20gYSBjZWxsCmRlZiBfcmVwcl9wbmdfKCk6CiAgICBidWYgPSBpby5CeXRlc0lPKCkKICAgIHBsdC5zYXZlZmlnKGJ1ZiwgZm9ybWF0PSdwbmcnLCBiYm94X2luY2hlcz0ndGlnaHQnKQogICAgYnVmLnNlZWsoMCkKICAgIGltYWdlX2Jhc2U2NCA9IGJhc2U2NC5iNjRlbmNvZGUoYnVmLmdldHZhbHVlKCkpLmRlY29kZSgndXRmLTgnKSAKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKICAgIGJ1Zi5jbG9zZSgpCiAgICByZXR1cm4gaW1hZ2VfYmFzZTY0CgpwbHQuX3JlcHJfcG5nXyA9IF9yZXByX3BuZ18KCiMgT3ZlcnJpZGUgdGhlIG9yaWdpbmFsIHNob3cgZnVuY3Rpb24KZGVmIG1hdHBsb3RsaWJfY3VzdG9tX3Nob3coKToKICAgIGltYWdlX2Jhc2U2NCA9IHBsdC5fcmVwcl9wbmdfKCkKICAgIGpzLmltYWdlQmFzZTY0KGltYWdlX2Jhc2U2NCkgIyB0eXBlOmlnbm9yZSAgICAKCnBsdC5zaG93ID0gbWF0cGxvdGxpYl9jdXN0b21fc2hvdwo=",y="data:application/octet-stream;base64,aW1wb3J0IHB5Z2FtZQppbXBvcnQgaW8sIGJhc2U2NApmcm9tIFBJTCBpbXBvcnQgSW1hZ2UKCgojIEN1c3RvbSBEaXNwbGF5IENsYXNzCmNsYXNzIEN1c3RvbURpc3BsYXk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5zdXJmYWNlID0gTm9uZQoKICAgIGRlZiBzZXRfbW9kZShzZWxmLCBzaXplLCBmbGFncz0wLCBkZXB0aD0wKToKICAgICAgICBzZWxmLnN1cmZhY2UgPSBweWdhbWUuU3VyZmFjZShzaXplKSAgIyBDcmVhdGUgYW4gb2ZmLXNjcmVlbiBzdXJmYWNlCiAgICAgICAgcmV0dXJuIHNlbGYuc3VyZmFjZQoKICAgIGRlZiB1cGRhdGUoc2VsZik6CiAgICAgICAgIyBQYXJ0aWFsIHVwZGF0ZXMgYXJlIGN1cnJlbnRseSB1bnN1cHBvcnRlZAogICAgICAgIHJldHVybiBzZWxmLmZsaXAoKQoKICAgIGRlZiBmbGlwKHNlbGYpOgogICAgICAgICMgVXBkYXRlcyB0aGUgc2NyZWVuIHN1cmZhY2UgYW5kIHJldHVybnMgdG8gSlMgYXMgYSBiYXNlNjQgc3RyaW5nCiAgICAgICAgZGF0YV9ieXRlcyA9IHB5Z2FtZS5pbWFnZS50b2J5dGVzKHNlbGYuc3VyZmFjZSwgJ1JHQicpCiAgICAgICAgaW1hZ2UgPSBJbWFnZS5mcm9tYnl0ZXMoJ1JHQicsIHNlbGYuc3VyZmFjZS5nZXRfc2l6ZSgpLCBkYXRhX2J5dGVzKQogICAgICAgIGJ1ZmZlciA9IGlvLkJ5dGVzSU8oKQogICAgICAgIGltYWdlLnNhdmUoYnVmZmVyLCBmb3JtYXQ9J1BORycpCiAgICAgICAgYnVmZmVyLnNlZWsoMCkKICAgICAgICBpbWFnZV9iYXNlNjQgPSBiYXNlNjQuYjY0ZW5jb2RlKGJ1ZmZlci5nZXR2YWx1ZSgpKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICBqcy5pbWFnZUJhc2U2NChpbWFnZV9iYXNlNjQpICMgdHlwZTppZ25vcmUKCiAgICBkZWYgc2V0X2NhcHRpb24oc2VsZiwgdGl0bGUpOgogICAgICAgICMgTm8tb3Agb24gc2V0X2NhcHRpb24sIHdlIGRvbid0IG5lZWQgaXQgZm9yIHRoZSBub3RlYm9vawogICAgICAgIHBhc3MKCiMgQ3VzdG9tIEV2ZW50IENsYXNzCmNsYXNzIEN1c3RvbUV2ZW50OgogICAgZGVmIGdldChzZWxmKToKICAgICAgICAjIFJldHVybiBlbXB0eSBsaXN0IHNpbmNlIHdlIGRvbid0IG5lZWQgZXZlbnRzIGluIHRoZSBub3RlYm9vawogICAgICAgIHJldHVybiBbXQoKIyBDdXN0b20gaW5pdCBmdW5jdGlvbgpkZWYgX2N1c3RvbV9pbml0KCk6CiAgICAjIE5vLW9wIG9uIGluaXQsIHdlIGRvbid0IG5lZWQgaXQgZm9yIHRoZSBub3RlYm9vawogICAgcHlnYW1lLmRpc3BsYXkgPSBDdXN0b21EaXNwbGF5KCkKICAgIHB5Z2FtZS5ldmVudCA9IEN1c3RvbUV2ZW50KCkKCmRlZiBjdXN0b21fcXVpdCgpOgogICAgIyBOby1vcCBvbiBxdWl0LCB3ZSBkb24ndCBuZWVkIGl0IGZvciB0aGUgbm90ZWJvb2sKICAgIHBhc3MKCiMgUmVwbGFjZSBweWdhbWUuaW5pdCwgcXVpdCwgZGlzcGxheSBhbmQgZXZlbnQKcHlnYW1lLmluaXQgPSBfY3VzdG9tX2luaXQKcHlnYW1lLnF1aXQgPSBjdXN0b21fcXVpdAo=";const A=[{module:"matplotlib",dependencies:[]},{module:"pygame-ce",dependencies:["pillow"]}],u=async(g,I)=>{const e=A.find(i=>i.module===I);if(!e){console.warn(`No override configuration found for module: ${I}`);return}e.dependencies&&e.dependencies.length>0&&(console.log(`Loading dependencies for ${I}:`,e.dependencies),await g.loadPackage(e.dependencies));const c=e.file||I,o=await(await fetch(new URL(Object.assign({"./matplotlib.py":G,"./pygame-ce.py":y})[`./${c}.py`],import.meta.url))).text();await g.runPythonAsync(o)};let l,d=null;const m=typeof SharedArrayBuffer<"u";async function r(g){const e=await(await fetch(g)).text();await l.runPythonAsync(e)}async function B(){console.log("PyodideWorker: Starting Pyodide initialization...");{const{loadPyodide:g}=await import(new URL("../pyodide/pyodide.mjs",import.meta.url).toString());l=await g()}if(console.log("PyodideWorker: Checking for interrupt buffer"),m){const g=new SharedArrayBuffer(4);d=new Int32Array(g),l.setInterruptBuffer(d),console.log("PyodideWorker: Interrupt buffer created")}else console.warn("PyodideWorker: SharedArrayBuffer is not available, interrupt functionality will be disabled");console.log("PyodideWorker: Creating override for stdout"),l.globals.set("_override_stdout",{write:g=>(self.postMessage({type:"stdout",text:g}),g.length),flush:()=>{}}),console.log("PyodideWorker: Overriding input calls with async equivalent"),r(new URL("data:application/octet-stream;base64,aW1wb3J0IGFzdAoKY2xhc3MgSW5wdXRUcmFuc2Zvcm1lcihhc3QuTm9kZVRyYW5zZm9ybWVyKToKICAgIGRlZiB2aXNpdF9DYWxsKHNlbGYsIG5vZGUpOgogICAgICAgICMgUmVjdXJzaXZlbHkgdHJhbnNmb3JtIGNoaWxkIG5vZGVzIGZpcnN0CiAgICAgICAgc2VsZi5nZW5lcmljX3Zpc2l0KG5vZGUpCiAgICAgICAgCiAgICAgICAgIyBDaGVjayBpZiB0aGlzIGlzIGFuIGlucHV0KCkgY2FsbAogICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZS5mdW5jLCBhc3QuTmFtZSkgYW5kIG5vZGUuZnVuYy5pZCA9PSAnaW5wdXQnOgogICAgICAgICAgICAjIENoZWNrIGlmIHdlJ3JlIGFscmVhZHkgaW5zaWRlIGFuIEF3YWl0IG5vZGUKICAgICAgICAgICAgcGFyZW50ID0gZ2V0YXR0cihub2RlLCAncGFyZW50JywgTm9uZSkKICAgICAgICAgICAgd2hpbGUgcGFyZW50OgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShwYXJlbnQsIGFzdC5Bd2FpdCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUKICAgICAgICAgICAgICAgIHBhcmVudCA9IGdldGF0dHIocGFyZW50LCAncGFyZW50JywgTm9uZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSWYgbm90IGF3YWl0ZWQsIHdyYXAgaW4gQXdhaXQKICAgICAgICAgICAgcmV0dXJuIGFzdC5Bd2FpdCgKICAgICAgICAgICAgICAgIHZhbHVlPW5vZGUsCiAgICAgICAgICAgICAgICBsaW5lbm89bm9kZS5saW5lbm8sCiAgICAgICAgICAgICAgICBjb2xfb2Zmc2V0PW5vZGUuY29sX29mZnNldAogICAgICAgICAgICApCiAgICAgICAgcmV0dXJuIG5vZGUKCmRlZiBfc2V0X3BhcmVudHMobm9kZSwgcGFyZW50PU5vbmUpOgogICAgIyBIZWxwZXIgdG8gc2V0IHBhcmVudCByZWZlcmVuY2VzIGZvciBhbGwgbm9kZXMKICAgIG5vZGUucGFyZW50ID0gcGFyZW50CiAgICBmb3IgY2hpbGQgaW4gYXN0Lml0ZXJfY2hpbGRfbm9kZXMobm9kZSk6CiAgICAgICAgX3NldF9wYXJlbnRzKGNoaWxkLCBub2RlKQoKZGVmIHRyYW5zZm9ybV9jb2RlKGNvZGVfc3RyKToKICAgIHRyeToKICAgICAgICAjIFBhcnNlIHRoZSBjb2RlIGludG8gYW4gQVNUCiAgICAgICAgdHJlZSA9IGFzdC5wYXJzZShjb2RlX3N0cikKICAgICAgICAKICAgICAgICAjIFNldCBwYXJlbnQgcmVmZXJlbmNlcwogICAgICAgIF9zZXRfcGFyZW50cyh0cmVlKQogICAgICAgIAogICAgICAgICMgVHJhbnNmb3JtIHRoZSBBU1QKICAgICAgICB0cmFuc2Zvcm1lciA9IElucHV0VHJhbnNmb3JtZXIoKQogICAgICAgIG5ld190cmVlID0gdHJhbnNmb3JtZXIudmlzaXQodHJlZSkKICAgICAgICAKICAgICAgICAjIEZpeCBhbnkgbWlzc2luZyBsb2NhdGlvbnMKICAgICAgICBhc3QuZml4X21pc3NpbmdfbG9jYXRpb25zKG5ld190cmVlKQogICAgICAgIAogICAgICAgICMgQ29udmVydCBiYWNrIHRvIHNvdXJjZSBjb2RlCiAgICAgICAgdHJhbnNmb3JtZWRfY29kZSA9IGFzdC51bnBhcnNlKG5ld190cmVlKQogICAgICAgIHJldHVybiB0cmFuc2Zvcm1lZF9jb2RlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJUcmFuc2Zvcm1hdGlvbiBlcnJvcjoge3N0cihlKX0iKQogICAgICAgICMgSWYgdHJhbnNmb3JtYXRpb24gZmFpbHMsIHJldHVybiB0aGUgb3JpZ2luYWwgY29kZQogICAgICAgIHJldHVybiBjb2RlX3N0cgo=",import.meta.url)),console.log("PyodideWorkder: Creating override for input"),l.globals.set("_override_input",g=>new Promise(I=>{self.postMessage({type:"input_request",message:g||""});const e=c=>{c.data.type==="input_response"&&(self.removeEventListener("message",e),I(c.data.value))};self.addEventListener("message",e)})),console.log("PyodideWorker: Creating override for js functions"),l.globals.set("js",{imageBase64:g=>{self.postMessage({type:"execute_result",result:{"image/png":[g]}})}}),console.log("PyodideWorker: Initializing Python environment"),r(new URL("data:application/octet-stream;base64,IyB0eXBlOmlnbm9yZQppbXBvcnQgYnVpbHRpbnMKaW1wb3J0IHN5cwoKZGVmIF9vdmVycmlkZV9pbnB1dF93cmFwcGVyKHByb21wdD0nJyk6CiAgICByZXR1cm4gX292ZXJyaWRlX2lucHV0KHByb21wdCkKCnN5cy5zdGRvdXQgPSBfb3ZlcnJpZGVfc3Rkb3V0IApidWlsdGlucy5pbnB1dCA9IF9vdmVycmlkZV9pbnB1dF93cmFwcGVyCg==",import.meta.url))}self.onmessage=async g=>{const{type:I,...e}=g.data;switch(I){case"initialize":try{await B(),self.postMessage({type:"initialized",interruptBuffer:d?d.buffer:null,hasInterrupt:m})}catch(o){console.error("PyodideWorker: Failed to initialize Pyodide:",o),self.postMessage({type:"fatal",error:String(o)})}break;case"run":const c=e.code,n=e.cellId;try{if(l){console.log("PyodideProvider: Loading packages from imports");const o=await l.loadPackagesFromImports(c);console.log("PyodideProvider: Loading additional packages from code");const i=await l.loadPackage(p(c));console.log("PyodideProvider: Searching for overrides");for(const s of[...o,...i])A.find(Z=>Z.module===s.name)&&(console.log(`PyodideProvider: Implementing override for ${s.name}`),await u(l,s.name));console.log("PyodideProvider: Transforming code to support async inputs");const t=await l.runPythonAsync(`transform_code(${JSON.stringify(c)})`);console.log(`PyodideProvider: Running cell ${n}`);const C=await l.runPythonAsync(`${t}`);console.log("PyodideProvider: Returning result"),C&&(typeof C=="object"?("_repr_svg_"in C&&self.postMessage({type:"execute_result",result:{"image/svg+xml":C._repr_svg_()}}),"_repr_html_"in C&&self.postMessage({type:"execute_result",result:{"text/html":C._repr_html_()}}),"_repr_png_"in C&&self.postMessage({type:"execute_result",result:{"image/png":C._repr_png_()}}),self.postMessage({type:"execute_result",result:{"text/plain":C.__repr__()}})):self.postMessage({type:"execute_result",result:{"text/plain":C.toString()}})),self.postMessage({type:"execute_completed"})}}catch(o){console.error(o),self.postMessage({type:"error",error:String(o)})}break}};
